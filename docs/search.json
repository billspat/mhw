[{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"about-the-database","dir":"Articles","previous_headings":"","what":"About the database","title":"Working with the MHW-CI database","text":"project stores data single, local, SQL database uses duckdb platform. platform easy install (install.packages('duckdb')) can work local file (server required). project imports tables created scenario, tables include ensemble members column “ensemble” indicating one. imports CSV files created Dr. Lala Kounta using Matlab. see vignette(“using_mhw_database”) reading, summarizing plotting data.","code":""},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"export-to-csv","dir":"Articles","previous_headings":"","what":"Export to CSV","title":"Working with the MHW-CI database","text":"Currently, scenario/ensemble files Matlab data format (HDF5) ’ve found ’s best use Matlab export . Essentially files need opened matlab , selecting data element save, using writetable() given matlab file path variable `f’ data element (matrix) MHW MHW metrics , just See file matlab/mhw_export_text.m short script read files directory (ensemble outputs) use parallel pool write CSV files.","code":"% load MHW matrix mhwdata = load(f,'MHW'); % construct a new file name for the CSV export  mhwfile = strcat(f, '.mhw.csv');  % export to CSV writetable(mhwdata.MHW, mhwfile);"},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"creating-sql-code-for-import","dir":"Articles","previous_headings":"","what":"Creating SQL code for import","title":"Working with the MHW-CI database","text":"duckdb makes easy read various formats using Select * <filepath> syntax import multiple CSVs table, use strategy uses ‘union’ combine multiple select statements. See file db/build_mhw_db.sql example . SQL statements assume CSV files created file path . Example: actual example import ensembles ‘001’ ‘010’. running select statement, can create new columns constant values just using syntax   creates new column value every row. useful creating colum ensemble number since column source data want know . Since scenarios different tables may essential also create scenario column ’s good pro-active since may want combine metrics across scenarios comparison database takes long much memory R. can create new table copying syntax, changing table name file paths. SQL concept loops conditionals, generate code using programming language like R ’s just easier copy/paste","code":"create table arise10_metrics as      SELECT *, '001' AS ensemble, 'ARISE-1.0' AS scenario FROM 'ARISE-1.0/MHW_metrics_Model_001.mat.mhw.csv'     UNION     SELECT *, '002' AS ensemble, 'ARISE-1.0' AS scenario FROM 'ARISE-1.0/MHW_metrics_Model_002.mat.mhw.csv';"},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"latlong","dir":"Articles","previous_headings":"","what":"lat/long","title":"Working with the MHW-CI database","text":"originl matlab matrices use index number x y must converted lat/lon. See build_mhw_db.sql table lat/lon indexes created exports, can used add new columns table ’ve created using syntax . update command uses clause link yloc value original table yloc value lat_index table links latititude value lat repeat lon","code":"alter table arise10_metrics add column lat DOUBLE; update arise10_metrics set lat = lat_index.lat from lat_index where arise10_metrics.yloc = lat_index.yloc ;"},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"index","dir":"Articles","previous_headings":"","what":"Index","title":"Working with the MHW-CI database","text":"Creating indexes optional necessary find using SQL tables takes long time.","code":""},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"running-sql-code","dir":"Articles","previous_headings":"","what":"running SQL code","title":"Working with the MHW-CI database","text":"create SQL file list SQL commands, need run database. duckdb, database just another file (name) tell duckdb db file open. can run database versions , database needs already lat_index lon_index tables convert x/y indexes lat lon. several methods accomplish use command line. , folder run script/sql commands must correct path CSV file SQL statements","code":""},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"using-the-duckdb-command-line-interface","dir":"Articles","previous_headings":"running SQL code","what":"using the duckdb Command line interface","title":"Working with the MHW-CI database","text":"install duckdb downloading zip file https://duckdb.org (laptop, linux HPC) home directory unzipping know path duckdb file located (optionally add location $PATH) know path database. path db/mhw_ci.db anywhere change folder CSV files open database duckdb command: path//duckdb path//mhw_ci.db inside duckdb command line interface, type sql command (copy/paste) run: sql * x_lat example","code":""},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"running-a-sql-script-using-the-duckdb-program","dir":"Articles","previous_headings":"running SQL code","what":"running a sql script using the duckdb program","title":"Working with the MHW-CI database","text":"alternatives steps 5 & 6 just step 5, folder CSV files run sql code file database: path//duckdb path//database.db < path//.sql command duckdb db/mhwci.db db/build_mhw_db.sql","code":""},{"path":"https://srm-ecology.github.io/mhwci/articles/importing_into_database.html","id":"alternative-using-rstudio","dir":"Articles","previous_headings":"running SQL code","what":"Alternative using Rstudio","title":"Working with the MHW-CI database","text":"place special comment top SQL file, can run script directly Rstudio. requires duckdb package installed, CSV file path SQL relative R project folder. See file db/example.sql comment SQL commands return table, previewed. commands create tables (called “data definition language” DDL commands) still run Rstudio provide path CSV files SQL commands correct.","code":"-- !preview conn=DBI::dbConnect(duckdb::duckdb(), dbdir = 'db/mhwci_v3.db')"},{"path":"https://srm-ecology.github.io/mhwci/articles/using_mhw_database.html","id":"calculating-metrics","dir":"Articles","previous_headings":"","what":"Calculating Metrics","title":"Using the MHW-CI database to plot","text":"Set scenario table use plot. function queries table average durations point decade data frames x, y value, uses terra package create rasters decades list. also rotates world plots center along prime meridian instead dateline. Plot list rasters, setting name metric (average duration) threshold 1/2 year","code":"mhw_table <-\"arise10_decade_metrics\" raster_list <- durations_by_decade_raster(db, mhw_table) print(raster_list) #> class       : SpatRaster  #> dimensions  : 178, 288, 3  (nrow, ncol, nlyr) #> resolution  : 1.25, 0.9424084  (x, y) #> extent      : -180.625, 179.375, -78.2199, 89.5288  (xmin, xmax, ymin, ymax) #> coord. ref. : WGS 84 / World Equidistant Cylindrical (EPSG:4087)  #> source(s)   : memory #> names       :     2040,     2050,    2060  #> min values  :   5.0000,   5.0000,    5.00  #> max values  : 352.6837, 760.3404, 3040.25 plot_rasters_squish_outliers(raster_list, title = mhw_table,                               scale_label = \"Average Duration, d\",                               )"},{"path":"https://srm-ecology.github.io/mhwci/articles/using_mhw_database.html","id":"plot-duration-other-scenarios","dir":"Articles","previous_headings":"","what":"Plot duration other scenarios","title":"Using the MHW-CI database to plot","text":"Combine commands plot scenarios. Note change title manually. re-uses connection object db created . duration_rasters() function calls function create run SQL database","code":"raster_list <- durations_by_decade_raster(db, mhw_table= \"arise15_decade_metrics\") plot_rasters_squish_outliers(raster_list, title = \"ARISE 1.5 Average Duration\",                               scale_label = \"Mean Duration, d\",                               threshold = 365/2) raster_list <- durations_by_decade_raster(db, mhw_table= \"ssp245_decade_metrics\") plot_rasters_squish_outliers(raster_list, title = \"SSP2 4.5 Average Duration\",                               scale_label = \"Mean Duration, d\",                               threshold = 365/2)"},{"path":"https://srm-ecology.github.io/mhwci/articles/using_mhw_database.html","id":"plot-other-metrics-and-summaries","dir":"Articles","previous_headings":"","what":"Plot other metrics and summaries","title":"Using the MHW-CI database to plot","text":"functions summary metrics various statistics (mean, median, min, max, mode, etc) Let’s take average average intensity","code":"# set the table mhw_table <- \"arise10_decade_metrics\" # select the metric or column in the table above mhw_metric <- 'int_mean' # select the summary function, must be one of the SQL functions, not an R function sql_function <- 'avg'  #create the rasters for each decade for this metric, similar to duration but tis is a generic function raster_list <- metrics_by_decade_raster(db, mhw_table, mhw_metric = mhw_metric, sql_function = sql_function)  # plot, constructing the title from the variables we set above # no threshold is set plot_rasters_squish_outliers(raster_list,                               title = paste(mhw_table, mhw_metric, sql_function),                               scale_label = \"avg intensity average, c\" )"},{"path":"https://srm-ecology.github.io/mhwci/articles/using_mhw_database.html","id":"filtering-ensembles","dir":"Articles","previous_headings":"","what":"Filtering ensembles","title":"Using the MHW-CI database to plot","text":"use special syntax, can select ensembles use summaries. format string list ensembles leading zeros, like \"006,007,008\" Ten leading zero , \"010\" vector string! (now). See code ","code":"ensemble_list_string = \"006,007,008\"  #create the rasters for each decade for this metric, similar to duration but tis is a generic function raster_list <- metrics_by_decade_raster(db, mhw_table, mhw_metric = mhw_metric, sql_function = sql_function,                                          ensemble_list_string = ensemble_list_string )  # plot, constructing the title from the variables we set above # no threshold is set plot_rasters_squish_outliers(raster_list,                               title = paste(mhw_table, mhw_metric, sql_function, \" ensembles \", ensemble_list_string),                               scale_label = \"avg intensity average, c\")"},{"path":"https://srm-ecology.github.io/mhwci/articles/using_mhw_database.html","id":"using-sql-directly","dir":"Articles","previous_headings":"","what":"Using SQL directly","title":"Using the MHW-CI database to plot","text":"can run SQL command get data using duckdb database engine, fast. SQL averages duration specific table run query: Now close connection used , otherwise may errors (“set lock file …”)","code":"# this is a function that creates a string of SQL with the table we want to use sql<- avg_duration_by_decade_sql(mhw_table) print(sql) #> SELECT lat, lon, decades.decade, avg(mhw_dur) as avg_dur  #>   FROM arise10_decade_metrics, decades  #> WHERE ((mhw_onset_date >= decades.decade_start) AND (mhw_onset_date <= decades.decade_end))  #> GROUP BY lat, lon, decades.decade # run this SQL using the `dbGetQuery` command.   duration_by_loc<- DBI::dbGetQuery(db, sql) # show the first few rows head(duration_by_loc) #>          lat   lon decade  avg_dur #> 1 -42.879581 68.75   2060 21.87387 #> 2 -26.858639 68.75   2060 30.79167 #> 3 -22.146597 68.75   2060 32.38220 #> 4  -8.952879 68.75   2060 26.31000 #> 5  -2.356021 68.75   2060 21.78571 #> 6   6.125655 68.75   2060 29.43498 DBI::dbDisconnect(db)"},{"path":"https://srm-ecology.github.io/mhwci/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Pat Bills. Author, maintainer. Lala Kounta. Author. Phoebe Zarnetske. Author.","code":""},{"path":"https://srm-ecology.github.io/mhwci/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Bills P, Kounta L, Zarnetske P (2024). mhwci: Marine Heat Wave Analyis Climate Intervention. R package version 0.1.0, https://srm-ecology.github.io/mhwci/, https://billspat.github.io/mhw/.","code":"@Manual{,   title = {mhwci: Marine Heat Wave Analyis for Climate Intervention},   author = {Pat Bills and Lala Kounta and Phoebe Zarnetske},   year = {2024},   note = {R package version 0.1.0, https://srm-ecology.github.io/mhwci/},   url = {https://billspat.github.io/mhw/}, }"},{"path":"https://srm-ecology.github.io/mhwci/index.html","id":"mhwci-marine-heat-wave-for-climate-intervention","dir":"","previous_headings":"","what":"mhwci: Marine Heat Wave for Climate Intervention","title":"Marine Heat Wave Analyis for Climate Intervention","text":"R package database analysis ‘Marine Heat Waves Climate Change & Climate Intervention’ (prep) Authors: Lala Kounta Pat Bills Phoebe Zarnetske","code":""},{"path":"https://srm-ecology.github.io/mhwci/index.html","id":"overview","dir":"","previous_headings":"","what":"Overview","title":"Marine Heat Wave Analyis for Climate Intervention","text":"Package documentation work progress incomplete. results visualizations shown draft form considered final results statements made authors point. Description purpose, data sources, model basis etc forth coming. ‘package’ internal use publication paper, continuation Dr. Lala Kounta’s project https://github.com/srm-ecology/MHW_climateintervention Uses EDI data framework (come)","code":""},{"path":"https://srm-ecology.github.io/mhwci/index.html","id":"requirementsinstall","dir":"","previous_headings":"","what":"Requirements/Install","title":"Marine Heat Wave Analyis for Climate Intervention","text":"package relies terra package also requires Gdal libraries installed computer. Data stored database file, Rdata files. database constructed exported CSV files SQL code `/db’ folder database duckdb format, open source, -process columnar database analytics. climate data prepared create database tables 20M rows. See vignette instructions specifying path database file work .","code":""},{"path":"https://srm-ecology.github.io/mhwci/index.html","id":"note-about-usage-on-msu-hpc","dir":"","previous_headings":"Requirements/Install","what":"Note about Usage on MSU HPC","title":"Marine Heat Wave Analyis for Climate Intervention","text":"running computer, install software need. MSU HPC uses ‘module system’ select software already installed. application requires following modules loaded: R/4.3.2-gfbf-2023a: specific MSU, R module also loads many packages module load UDUNITS, GEOS, PROJ, GDAL Note uppercase versions compatible R installed. avoid load everytime, can create file .Rprofile following : run running MSU HPC load modules needed R starts .","code":"if(Sys.getenv('HPCC_CLUSTER_FLAVOR')!='') {   # load required MSU HPC Modules for spatial work   source(file.path(Sys.getenv(\"LMOD_PKG\"), \"init/R\"))   module(\"load\", \"UDUNITS\")   module(\"load\", \"GEOS\")   module(\"load\", \"PROJ\")   module(\"load\", \"GDAL\") }"},{"path":"https://srm-ecology.github.io/mhwci/index.html","id":"basic-usage","dir":"","previous_headings":"","what":"Basic Usage","title":"Marine Heat Wave Analyis for Climate Intervention","text":"See articles linked R markdown file vignettes folder.","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_sql.html","id":null,"dir":"Reference","previous_headings":"","what":"sql to summary scenario table — avg_duration_by_decade_sql","title":"sql to summary scenario table — avg_duration_by_decade_sql","text":"sql code calc avg duration grouped decade. Decade start/end dates come table 'decades' must exist database","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_sql.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"sql to summary scenario table — avg_duration_by_decade_sql","text":"","code":"avg_duration_by_decade_sql(mhw_table, use_end_date = FALSE)"},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_sql.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"sql to summary scenario table — avg_duration_by_decade_sql","text":"mhw_table character name scenario table use use_end_date boolean TRUE: use waves ending decade; FALSE: use waves starting deacde","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_sql.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"sql to summary scenario table — avg_duration_by_decade_sql","text":"character sql code run","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_truncated_sql.html","id":null,"dir":"Reference","previous_headings":"","what":"create SQL tocalculate average duration of marine heatwaves by point in space, grouped by decade — avg_duration_by_decade_truncated_sql","title":"create SQL tocalculate average duration of marine heatwaves by point in space, grouped by decade — avg_duration_by_decade_truncated_sql","text":"craft sql code calculate averge MHW duration, using data tables models truncated decade run table restrict tables needed analysis.   Tables required column lat, lon, mhw_onset (integer formatted dates like 20411231), mhw_dur function check table columns, generates string SQL","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_truncated_sql.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"create SQL tocalculate average duration of marine heatwaves by point in space, grouped by decade — avg_duration_by_decade_truncated_sql","text":"","code":"avg_duration_by_decade_truncated_sql(   mhw_table,   start_year = 2040,   end_year = 2069,   ensemble_list_string = NA )"},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_truncated_sql.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"create SQL tocalculate average duration of marine heatwaves by point in space, grouped by decade — avg_duration_by_decade_truncated_sql","text":"mhw_table character name table analyze start_year integer year start, inclusive (dates include start year) end_year integer year end, inclusive (dates include 12/31 end year) ensemble_list_string character string list ensembles include format \"006,007,008\" ensembles leaving zeros, 3 digits must separated list leading zeros","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/avg_duration_by_decade_truncated_sql.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"create SQL tocalculate average duration of marine heatwaves by point in space, grouped by decade — avg_duration_by_decade_truncated_sql","text":"character SQL code run MHW database","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/check_mhw_connection.html","id":null,"dir":"Reference","previous_headings":"","what":"check if connection works — check_mhw_connection","title":"check if connection works — check_mhw_connection","text":"test db connection attempting run SQL work, specific project","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/check_mhw_connection.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"check if connection works — check_mhw_connection","text":"","code":"check_mhw_connection(conn, known_table_name = \"ensembles\")"},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_df.html","id":null,"dir":"Reference","previous_headings":"","what":"create table of start/end dates for year gaps — create_partition_df","title":"create table of start/end dates for year gaps — create_partition_df","text":"create table start/end dates year gaps","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"create table of start/end dates for year gaps — create_partition_df","text":"","code":"create_partition_df(   partition_size_years = 3,   start_year = 2040,   end_year = 2069 )"},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_df.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"create table of start/end dates for year gaps — create_partition_df","text":"partition_size_years integer width partitions whole years, 10 usually start_year integer year start partitioning (low end range), default 2040 end_year integer year end portioning","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_df.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"create table of start/end dates for year gaps — create_partition_df","text":"data frame years, start_date, end_date","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_table.html","id":null,"dir":"Reference","previous_headings":"","what":"create temporary partitions table — create_partition_table","title":"create temporary partitions table — create_partition_table","text":"create temporary table database partitions named 'partitions', used create joins metrics tables -database rather R space using dplyr speed can use SQL function destructive side effect overwriting existing partitions table. disappear connection disconnected garbage collected","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_table.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"create temporary partitions table — create_partition_table","text":"","code":"create_partition_table(   conn,   partition_size_years = 3,   start_year = 2040,   end_year = 2069 )"},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_table.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"create temporary partitions table — create_partition_table","text":"conn dbi database connection, see mhw_connect() partition_size_years integer width partitions whole years, 10 usually start_year integer year start partitioning (low end range), default 2040 end_year integer year end portioning","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/create_partition_table.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"create temporary partitions table — create_partition_table","text":"data frame copy table created partition_name, partition_start_date, partition_end_date","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/decades.html","id":null,"dir":"Reference","previous_headings":"","what":"main decades to use for analysis — decades","title":"main decades to use for analysis — decades","text":"main decades use analysis","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/decades.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"main decades to use for analysis — decades","text":"","code":"decades"},{"path":"https://srm-ecology.github.io/mhwci/reference/decades.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"main decades to use for analysis — decades","text":"object class character length 3.","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decade_sql.html","id":null,"dir":"Reference","previous_headings":"","what":"sql for parititioning wave durations by decade — duration_by_decade_sql","title":"sql for parititioning wave durations by decade — duration_by_decade_sql","text":"collect durations (summarized) decade, useful histograms. Decade start/end dates come table 'decades' must exist database","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decade_sql.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"sql for parititioning wave durations by decade — duration_by_decade_sql","text":"","code":"duration_by_decade_sql(mhw_table, use_end_date = FALSE)"},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decade_sql.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"sql for parititioning wave durations by decade — duration_by_decade_sql","text":"mhw_table character name scenario table use use_end_date boolean TRUE: use waves ending decade; FALSE: use waves starting deacde","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decade_sql.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"sql for parititioning wave durations by decade — duration_by_decade_sql","text":"character sql code run","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decades.html","id":null,"dir":"Reference","previous_headings":"","what":"calc mean duration by decade — duration_by_decades","title":"calc mean duration by decade — duration_by_decades","text":"calc mean duration decade","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decades.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"calc mean duration by decade — duration_by_decades","text":"","code":"duration_by_decades(mhwdb_conn, mhw_table)"},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decades.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"calc mean duration by decade — duration_by_decades","text":"mhwdb_conn database connection mhw database mhw_table character name table ensembles query","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/duration_by_decades.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"calc mean duration by decade — duration_by_decades","text":"list dataframes, one dataframe per decade, data frame see avg_duration_by_decade_sql ","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/durations_by_decade_raster.html","id":null,"dir":"Reference","previous_headings":"","what":"rasters of global heatwave duration per decade — durations_by_decade_raster","title":"rasters of global heatwave duration per decade — durations_by_decade_raster","text":"raster layers decade","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/durations_by_decade_raster.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"rasters of global heatwave duration per decade — durations_by_decade_raster","text":"","code":"durations_by_decade_raster(   mhwdb_conn,   mhw_table,   decades = c(\"2040\", \"2050\", \"2060\"),   crs = \"EPSG:4087\",   ensemble_list_string = NA )"},{"path":"https://srm-ecology.github.io/mhwci/reference/durations_by_decade_raster.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"rasters of global heatwave duration per decade — durations_by_decade_raster","text":"mhwdb_conn database connection mhw_table character string name table query, required (e.g. arise10_metrics) crs character coordinate reference system, EPSG:4087, alternatives EPSG:4326. ensemble_list_string character string list ensembles include format \"006,007,008\" ensembles leaving zeros, 3 digits must separated list leading zeros","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/durations_by_decade_raster.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"rasters of global heatwave duration per decade — durations_by_decade_raster","text":"terra raster stack layers decade","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/generate_duration_plots.html","id":null,"dir":"Reference","previous_headings":"","what":"plot a series of MHW tables as maps and histograms — generate_duration_plots","title":"plot a series of MHW tables as maps and histograms — generate_duration_plots","text":"plot series MHW tables maps histograms","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/generate_duration_plots.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"plot a series of MHW tables as maps and histograms — generate_duration_plots","text":"","code":"generate_duration_plots(   mhw_tables,   conn,   threshold = 365/2,   ensemble_list_string = NA,   pdf_file_name = NULL )"},{"path":"https://srm-ecology.github.io/mhwci/reference/generate_duration_plots.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"plot a series of MHW tables as maps and histograms — generate_duration_plots","text":"mhw_tables vector character names tables plot conn database connection use mhw functions threshold numeric common value use constrain scale plots, see plot_rasters_squish_outliers, default 365/2 pdf_file_name optional character set, used path pdf file","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/generate_duration_plots.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"plot a series of MHW tables as maps and histograms — generate_duration_plots","text":"plots path plots","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/generate_duration_plots.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"plot a series of MHW tables as maps and histograms — generate_duration_plots","text":"","code":"if (FALSE) { # \\dontrun{ db_file = get_dbfile() db <- mhw_connect(db_file) mhw_tables <- c('arise10_decade_metrics','arise15_decade_metrics','ssp245_decade_metrics' ) generate_duration_plots(mhw_tables, conn= db, threshold = 150, pdf_file_name = 'duration_plots.pdf') } # }"},{"path":"https://srm-ecology.github.io/mhwci/reference/get_dbfile.html","id":null,"dir":"Reference","previous_headings":"","what":"path to database — get_dbfile","title":"path to database — get_dbfile","text":"path database used defaults, loaded environment create file `.Renviron` main directory use , R project","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/get_dbfile.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"path to database — get_dbfile","text":"","code":"get_dbfile()"},{"path":"https://srm-ecology.github.io/mhwci/reference/make_view.html","id":null,"dir":"Reference","previous_headings":"","what":"given a sql statement create a view in db — make_view","title":"given a sql statement create a view in db — make_view","text":"Views stored sql act tables database.  useful creating SQL queries based sql inputs function short helps remember syntax","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/make_view.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"given a sql statement create a view in db — make_view","text":"","code":"make_view(conn, sql, viewname)"},{"path":"https://srm-ecology.github.io/mhwci/reference/metric_by_decade_sql.html","id":null,"dir":"Reference","previous_headings":"","what":"SQL template for all MHW metrics — metric_by_decade_sql","title":"SQL template for all MHW metrics — metric_by_decade_sql","text":"convenience function construct sql group decades one metrics calculating decade grouping tricky wraps .","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/metric_by_decade_sql.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"SQL template for all MHW metrics — metric_by_decade_sql","text":"","code":"metric_by_decade_sql(   mhw_table,   mhw_metric = \"int_mean\",   sql_function = \"avg\",   start_year = 2040,   end_year = 2069,   ensemble_list_string = NA )"},{"path":"https://srm-ecology.github.io/mhwci/reference/metric_by_decade_sql.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"SQL template for all MHW metrics — metric_by_decade_sql","text":"mhw_table name table use mhw_metric character name column table, mhw_dur, int_mean, etc start_year integer year start, inclusive (dates include start year) end_year integer year end, inclusive (dates include 12/31 end year) ensemble_list_string character string list ensembles include format \"006,007,008\" ensembles leaving zeros, 3 digits must separated list leading zeros sqlfun character aggregate function duckdb, see https://duckdb.org/docs/sql/functions/aggregates","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/metric_by_decade_sql.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"SQL template for all MHW metrics — metric_by_decade_sql","text":"character SQL code run MHW database","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/metrics_by_decade_raster.html","id":null,"dir":"Reference","previous_headings":"","what":"rasters of global heatwave duration per decade — metrics_by_decade_raster","title":"rasters of global heatwave duration per decade — metrics_by_decade_raster","text":"raster layers decade","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/metrics_by_decade_raster.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"rasters of global heatwave duration per decade — metrics_by_decade_raster","text":"","code":"metrics_by_decade_raster(   mhwdb_conn,   mhw_table,   mhw_metric = \"int_mean\",   sql_function = \"avg\",   decades = c(\"2040\", \"2050\", \"2060\"),   ensemble_list_string = NA,   crs = \"EPSG:4087\" )"},{"path":"https://srm-ecology.github.io/mhwci/reference/metrics_by_decade_raster.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"rasters of global heatwave duration per decade — metrics_by_decade_raster","text":"mhwdb_conn database connection mhw_table character string name table query, required (e.g. arise10_metrics) ensemble_list_string character string list ensembles include format \"006,007,008\" ensembles leaving zeros, 3 digits must separated list leading zeros crs character coordinate reference system, EPSG:4087, alternatives EPSG:4326.","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/metrics_by_decade_raster.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"rasters of global heatwave duration per decade — metrics_by_decade_raster","text":"terra raster stack layers decade","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_connect.html","id":null,"dir":"Reference","previous_headings":"","what":"get connection to mhw database — mhw_connect","title":"get connection to mhw database — mhw_connect","text":"get connection, also ensure least one required tables","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_connect.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"get connection to mhw database — mhw_connect","text":"","code":"mhw_connect(duckdbfilepath, required_table_name = \"ensembles\")"},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_connect.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"get connection to mhw database — mhw_connect","text":"duckdbfilepath posix path .duckdb file required_table_name name table must db check ","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_connect.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"get connection to mhw database — mhw_connect","text":"duckdb DBI database connection object use DBI::dbGetQuery, etc NA found","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_table.html","id":null,"dir":"Reference","previous_headings":"","what":"get dbplyr table connection — mhw_table","title":"get dbplyr table connection — mhw_table","text":"get dbplyr table connection","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_table.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"get dbplyr table connection — mhw_table","text":"","code":"mhw_table(conn, table_name)"},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_table.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"get dbplyr table connection — mhw_table","text":"conn database connection table_name character name table","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/mhw_table.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"get dbplyr table connection — mhw_table","text":"dplyr table connection use dplyr syntax ","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events.html","id":null,"dir":"Reference","previous_headings":"","what":"assign partition to each event — partition_mhw_events","title":"assign partition to each event — partition_mhw_events","text":"assign partition_start (year) every event mhw metrics table sent based either start end date mhw, new column called partition_start","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"assign partition to each event — partition_mhw_events","text":"","code":"partition_mhw_events(   conn,   mhw_table_name,   partition_size_years = 3,   start_year = 2040,   end_year = 2069,   use_end_date = TRUE )"},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"assign partition to each event — partition_mhw_events","text":"conn dbi database connection, see mhw_connect() mhw_table_name name main metrics table use partition_size_years width partions years start_year year start partitions default 2040 end_year year end partitions  default 2069 use_end_date bolean deafult TRUE","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"assign partition to each event — partition_mhw_events","text":"dbplyr 'table', data frame partition value assigned event column partition_start","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated.html","id":null,"dir":"Reference","previous_headings":"","what":"mhw_partitioning.R this is a work in progress (WIP) and not complete table of truncated mhw metrics by partitions — partition_mhw_events_truncated","title":"mhw_partitioning.R this is a work in progress (WIP) and not complete table of truncated mhw metrics by partitions — partition_mhw_events_truncated","text":"given set partitions dates, create table matching waves partions truncated ","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"mhw_partitioning.R this is a work in progress (WIP) and not complete table of truncated mhw metrics by partitions — partition_mhw_events_truncated","text":"","code":"partition_mhw_events_truncated(   conn,   mhw_table_name,   partition_size_years = 3,   start_year = 2040,   end_year = 2069 )"},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"mhw_partitioning.R this is a work in progress (WIP) and not complete table of truncated mhw metrics by partitions — partition_mhw_events_truncated","text":"conn dbi database connection, see mhw_connect() mhw_table_name name main metrics table use partition_size_years width partions years start_year year start partitions default 2040 end_year year end partitions  default 2069","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"mhw_partitioning.R this is a work in progress (WIP) and not complete table of truncated mhw metrics by partitions — partition_mhw_events_truncated","text":"dplyr table fields mhw table, partition table (partition_name, partition_start_date, partition_end_date ),          mhw_portion = part wave, mhw_portion_start =  start date truncated mhw,          mhw_portion_end = end date truncate wave, partition_dur = duration days truncated wave","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated_sql.html","id":null,"dir":"Reference","previous_headings":"","what":"sql for partitioning — partition_mhw_events_truncated_sql","title":"sql for partitioning — partition_mhw_events_truncated_sql","text":"sql partitioning","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated_sql.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"sql for partitioning — partition_mhw_events_truncated_sql","text":"","code":"partition_mhw_events_truncated_sql(   mhw_table_name,   partition_size_years = 3,   start_year = 2040,   end_year = 2069 )"},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated_sql.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"sql for partitioning — partition_mhw_events_truncated_sql","text":"mhw_table_name name main metrics table use partition_size_years width partions years start_year year start partitions default 2040 end_year year end partitions  default 2069","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/partition_mhw_events_truncated_sql.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"sql for partitioning — partition_mhw_events_truncated_sql","text":"character sql create new table truncated mwh partition","code":""},{"path":[]},{"path":"https://srm-ecology.github.io/mhwci/reference/percentile_cutoff_value.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"find value for percentile cut-off — percentile_cutoff_value","text":"","code":"percentile_cutoff_value(x, cut_percent = 1)"},{"path":"https://srm-ecology.github.io/mhwci/reference/percentile_cutoff_value.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"find value for percentile cut-off — percentile_cutoff_value","text":"x values find cut-, numeric vector cut_percent numeric  top percent cut e.g. 1 cut top 1 numeric value x max befoe percentile indicated cut_percent   given range values, find max value just percentile, say 1 used divide range two bins set upper limit.  whole number sent, percentiles sequenced 1 like 2.25","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/plot_decade_rasters.html","id":null,"dir":"Reference","previous_headings":"","what":"plot of world rasters by layer, no outlier management — plot_decade_rasters","title":"plot of world rasters by layer, no outlier management — plot_decade_rasters","text":"use plot_rasters_squish_outliers instead plot mhw rasters","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/plot_decade_rasters.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"plot of world rasters by layer, no outlier management — plot_decade_rasters","text":"","code":"plot_decade_rasters(mhwdb_conn, mhw_table)"},{"path":[]},{"path":"https://srm-ecology.github.io/mhwci/reference/plot_rasters_squish_outliers.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"plot terra rasters, but manage outliers — plot_rasters_squish_outliers","text":"","code":"plot_rasters_squish_outliers(   raster_list,   title = \"\",   scale_label = \"\",   cut_percent = 0,   threshold_value = NA )"},{"path":"https://srm-ecology.github.io/mhwci/reference/plot_rasters_squish_outliers.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"plot terra rasters, but manage outliers — plot_rasters_squish_outliers","text":"raster_list terra spat raster list (stack?) title character title plot, default empty title scale_label character, label print legend/scale cut_percent numeric percentile cut-, see percentile_cutoff_value function descriptoin, 1 cut top 1 percent, 0.25 cut 0.25 threshold_valuenumeric optional numeric cut range display.  sent, cut_percent ignored ggplot object, one map item raster_list single legend   given list terra rasters plot, use heat gradient display values, cut top X percent replace values top color (red case) order handle extreme outliers.  Currently _not_ print max range (outliers) legend","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/sql_head.html","id":null,"dir":"Reference","previous_headings":"","what":"get first few rows from a sql statement — sql_head","title":"get first few rows from a sql statement — sql_head","text":"useful testing/exploration without creating large member objects","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/sql_head.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"get first few rows from a sql statement — sql_head","text":"","code":"sql_head(conn, sql, n = 10)"},{"path":"https://srm-ecology.github.io/mhwci/reference/table_head.html","id":null,"dir":"Reference","previous_headings":"","what":"get a few first rows of database table — table_head","title":"get a few first rows of database table — table_head","text":"useful testing/exploration without creating large memory objects","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/table_head.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"get a few first rows of database table — table_head","text":"","code":"table_head(conn, tablename, n = 10)"},{"path":"https://srm-ecology.github.io/mhwci/reference/table_head.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"get a few first rows of database table — table_head","text":"conn database connection tablename table exists database n number rows return, default 10","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/table_head.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"get a few first rows of database table — table_head","text":"dataframe result query, promise one db","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/windowing_overlap.html","id":null,"dir":"Reference","previous_headings":"","what":"create overlapping subsets of a sequence/vector — windowing_overlap","title":"create overlapping subsets of a sequence/vector — windowing_overlap","text":"draft/experimental function creating moving windows vectors years","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/windowing_overlap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"create overlapping subsets of a sequence/vector — windowing_overlap","text":"","code":"windowing_overlap(vec, seg.length, overlap = 0)"},{"path":"https://srm-ecology.github.io/mhwci/reference/windowing_overlap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"create overlapping subsets of a sequence/vector — windowing_overlap","text":"vec  seg.length  overlap","code":""},{"path":"https://srm-ecology.github.io/mhwci/reference/windowing_overlap.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"create overlapping subsets of a sequence/vector — windowing_overlap","text":"list subsets","code":""}]
